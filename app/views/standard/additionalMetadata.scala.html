@import helper._
@import java.util.UUID
@import graphql.codegen.GetConsignmentPaginatedFiles.getConsignmentPaginatedFiles.GetConsignment.PaginatedFiles.Edges
@import views.html.partials.transferReference
@import views.html.partials.inputSingleCheckbox
@(consignmentId: UUID, name: String, folderUploaded:String, totalPages: Int, limit:Option[Int], currentPage: Int, selectedFolderId: UUID, nodesFormData: Form[NodesFormData])(implicit messages: Messages, request: RequestHeader)
@main("Additional Metadata", name = name) {
    @defining(play.core.PlayVersion.current) { version =>
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                <h1 class="govuk-heading-l">
                    Add or edit closure metadata on file basis
                </h1>
                <div class="govuk-warning-text">
                    <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                    <strong class="govuk-warning-text__text">
                        <span class="govuk-warning-text__assistive">Warning</span>
                        Do not use your browsers back/forward buttons as this can lead to loss of data.
                    </strong>
                </div>
                <p class="govuk-body">You can now add or edit closure metadata to individual files or folders.</p>
                <p class="govuk-body">
                    Click on a particular file or folder to see what metadata is already captured and add or edit properties there.
                    For a bulk edit, first select files and/or folders and then choose an action from the menu.
                </p>
                <h2 class="app-task-list__section">Folder uploaded: @folderUploaded</h2>
                <div class="govuk-button-group">
@*                  <button class="govuk-button govuk-button--secondary" data-module="govuk-button" type="button" name="selectAll" value="select-all" onclick="check_all()">
                        Select all
                    </button>*@

                    <a href="#" role="button" draggable="false" class="govuk-button" data-module="govuk-button">
                        Add closure properties
                    </a>
                </div>

                @form(action = routes.AdditionalMetadataController.submit(consignmentId, currentPage, limit, selectedFolderId)) {
                    @CSRF.formField
                <input type="hidden" id="previouslySelected" name="previouslySelected" value="@{nodesFormData.value.get.previouslySelected}"/>
                <section id="page-@currentPage">
                    <table class="govuk-table">
                        <tbody class="govuk-table__body">
                        @nodesFormData.value.get.nodesToDisplay.map { node =>
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell">
                                    <div class="govuk-checkboxes__item">
                                        <input type='hidden' id="@node.nodeIdStr" name='allNodes[]' value="@node.nodeIdStr">
                                        <input class="govuk-checkboxes__input" id="@node.nodeIdStr" name="selected[]" type="checkbox" value="@node.nodeIdStr" @{if(node.isSelected) "checked"}>
                                        <label class="govuk-label govuk-checkboxes__label" for="@node.nodeIdStr">
                                            @if(node.isFolder) {
                                                üìÅ
                                                <button id="folderSelected" name="folderSelected" data-prevent-double-click="true" type="submit" role="button" value="@node.nodeIdStr">
                                                @node.displayName
                                                </button>
                                            } else {
                                                üìä @node.displayName
                                            }
                                        </label>
                                    </div>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </section>

                <nav class="govuk-pagination" role="navigation" aria-label="results">
                    @if(currentPage != 1) {
                        <div class="govuk-pagination__prev">
                            <button name="pageSelected" data-prevent-double-click="true" class="govuk-button" type="submit" data-module="govuk-button" role="button" value="@{currentPage - 1}">
                                Previous
                            </button>
@*                            <a class="govuk-link govuk-pagination__link" href="@routes.AdditionalMetadataController.getPaginatedFiles(consignmentId, currentPage-1, limit, selectedFolderId)" rel="prev">
                                <svg class="govuk-pagination__icon govuk-pagination__icon--prev" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                                    <path d=""></path>
                                </svg>
                                <span class="govuk-pagination__link-title">Previous</span></a>*@
                        </div>
                    }
                    <ul class="govuk-pagination__list">
                        @for(page <- 1 to totalPages){
                            <li class="govuk-pagination__item @if(currentPage == page){govuk-pagination__item--current}">
                                <button name="pageSelected" data-prevent-double-click="true" class="govuk-link govuk-pagination__link" type="submit" data-module="govuk-button" role="button" value="@{page}">
                                @page
                                </button>
@*                                <a class="govuk-link govuk-pagination__link" href="@routes.AdditionalMetadataController.getPaginatedFiles(consignmentId, page, limit, selectedFolderId)" aria-label="Page "@page aria-current="page">
                                @page
                                </a>*@
                            </li>
                        }
                    </ul>
                    @if(currentPage != totalPages) {
                        <div class="govuk-pagination__next">
                            <button name="pageSelected" data-prevent-double-click="true" class="govuk-button" type="submit" data-module="govuk-button" role="button" value="@{currentPage + 1}">
                                Next
                            </button>
@*                            <a class="govuk-link govuk-pagination__link" href="@routes.AdditionalMetadataController.getPaginatedFiles(consignmentId, currentPage + 1, limit, selectedFolderId)"> <span class="govuk-pagination__link-title">
                                Next</span> <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                                <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
                            </svg></a>*@
                        </div>
                    }
                </nav>
                    @*These hidden fields need to be at the bottom because POST requests will call the first Input*@
                    @*Also needed because the form needs to be fully completed*@
                    <input type="hidden" id="pageSelected" name="pageSelected" value="1"/>
                    <input type="hidden" id="folderSelected" name="folderSelected" value="@{nodesFormData.value.get.folderSelected}"/>
                }
            </div>
        </div>
    }
}
