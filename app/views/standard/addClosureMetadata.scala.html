@* helper package contains inputRadioGroup therefore exclude from imports to prevent ambiguous import with view of the same name *@
@import helper.{inputRadioGroup => _, _}

@import scala.language.postfixOps
@import views.html.partials.{inputDate, inputText, errorSummary, progressIndicator}

@import views.html.partials.transferReference
@import views.html.partials.inputRadioGroup

@import controllers.util._
@import views.html.partials.inputDropdown

@import controllers.AddClosureMetadataController.File
@import views.html.partials.multipleDropdown
@import controllers.AddClosureMetadataController.{PageInfo, ControllerInfo}

@(pageInfo: PageInfo, controllerInfo: ControllerInfo)(implicit request: RequestHeader, messages: Messages)
@main(s"${pageInfo.pageTitle} files", name = pageInfo.userName) {
  @defining(play.core.PlayVersion.current) { version =>
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        @progressIndicator(Messages("addClosureMetadata.progress"))
      <h1 class="govuk-heading-l">@pageInfo.pageTitle</h1>
        @for(file <- controllerInfo.files) {<h3>@file.name</h3>}
      <p class="govuk-body">@pageInfo.pageDescription</p>
        @errorSummary(
          pageInfo.fieldsToApplyToFile.collect {
            case p if p.fieldErrors.nonEmpty => (p.fieldId, p.fieldErrors)
          }
        )
        @form(
          routes.AddClosureMetadataController.addClosureMetadataSubmit(
              controllerInfo.isMainForm, controllerInfo.fieldsAndValuesSelectedOnPrevPage, controllerInfo.consignmentId, controllerInfo.files.map(_.fileId)),
          (Symbol("novalidate"), "")
        ) {
          @CSRF.formField
          @for(fieldToApplyToFile <- pageInfo.fieldsToApplyToFile) {
            @{
              fieldToApplyToFile match {
                case RadioButtonGroupField(fieldId, name, description, _, options, selectedOption, isRequired, fieldErrors) => inputRadioGroup(
                  fieldId,
                  name,
                  description,
                  options,
                  selectedOption,
                  Map(
                    Symbol("_label") -> name,
                    Symbol("_requiredOption") -> isRequired,
                    Symbol("_largeOption") -> true,
                    Symbol("_newlineOption") -> true,
                    Symbol("_disabledOption") -> "",
                    Symbol("_dynamicForm") -> true
                  ),
                  fieldErrors
                )
                case DateField(fieldId, fieldName, fieldDescription, _, day, month, year, _, fieldErrors, _) => inputDate(
                  fieldId,
                  fieldName,
                  fieldDescription,
                  day,
                  month,
                  year,
                  fieldErrors,
                  Map(Symbol("_dynamicForm") -> true)
                )
                case TextField(fieldId, fieldName, fieldDescription, _, inputNameAndValue, inputMode, _, fieldErrors) => inputText(
                  fieldId,
                  fieldName,
                  fieldDescription,
                  inputNameAndValue,
                  if(inputMode == "numeric") "number" else "text",
                  fieldErrors,
                  Map(Symbol("_dynamicForm") -> true),
                  inputMode,
                  addSuffixText = if(inputMode == "numeric") true else false
                )
                case DropdownField(fieldId, fieldName, fieldDescription, multiValue, options, selectedOption, _, fieldErrors) =>
                  inputDropdown(
                    fieldId,
                    fieldName,
                    fieldDescription,
                    options,
                    selectedOption,
                    multiValue,
                    Map(
                      Symbol("_disabledOption") -> "",
                      Symbol("_dynamicForm") -> true
                    ),
                    fieldErrors
                  )
                case CheckboxField(fieldId, fieldName, fieldDescription, multiValue, options, value, _, fieldErrors) =>
                  multipleDropdown(fieldId, fieldName, fieldDescription, multiValue, options, value.getOrElse(Nil), fieldErrors)
              }
            }
          }
          <div class="govuk-button-group">
              <!-- Continue -->
            <button data-prevent-double-click="true" class="govuk-button" type="submit" data-module="govuk-button" role="button">
              Continue
            </button>
            <a class="govuk-link" href="@routes.AdditionalMetadataNavigationController.getAllFiles(controllerInfo.consignmentId, "closure")">Cancel</a>
          </div>
        </div>
      }
      @transferReference(pageInfo.consignmentRef, isJudgmentUser = false)
    </div>

  }
}

